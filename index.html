<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Lucky Number Generator</title>
    <link rel="icon" type="image/png" href="favicon.png">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Luckiest+Guy&family=Poppins:wght@400;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: #111;
            color: #fff;
            overflow-x: hidden;
        }
        
        /* --- Hero Section (Top part of the page) --- */
        .hero-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        .background-glow {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 800px;
            height: 800px;
            background: radial-gradient(circle, rgba(22, 163, 74, 0.25) 0%, rgba(22, 163, 74, 0) 60%);
            transform: translate(-50%, -50%);
            z-index: 0;
            animation: pulse 5s infinite ease-in-out;
        }

        /* --- Floating Numbers Background --- */
        .floating-numbers {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            pointer-events: none;
        }

        .floating-numbers span {
            position: absolute;
            bottom: -100px; /* Start below the screen */
            font-family: 'Luckiest Guy', cursive;
            color: rgba(255, 255, 255, 0.05);
            animation: floatUp linear infinite;
        }

        @keyframes floatUp {
            from {
                transform: translateY(0);
                opacity: 1;
            }
            to {
                transform: translateY(-120vh); /* Move up past the top of the viewport */
                opacity: 0;
            }
        }

        @keyframes pulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.8; }
            50% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
        }
        
        .container {
            text-align: center;
            max-width: 650px;
            width: 100%;
            position: relative;
            z-index: 2;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 30px;
            padding: 40px;
            border: 2px solid rgba(253, 224, 71, 0.2);
            box-shadow: 0 0 40px rgba(22, 163, 74, 0.3), 0 0 60px rgba(0,0,0,0.7);
        }
        
        .header-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: #fde047; /* Gold */
            text-shadow: 0 0 15px #fde047;
            animation: floatIcon 3s ease-in-out infinite;
        }

        @keyframes floatIcon {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .number-container {
            height: 8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 25px;
        }
        
        .main-number {
            font-family: 'Luckiest Guy', cursive;
            font-size: 8rem;
            color: #fde047; /* Gold */
            text-shadow: 0 0 10px #fde047, 0 0 25px #fde047, 0 0 5px #fff;
            line-height: 1;
            transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
            opacity: 1;
            transform: scale(1);
        }
        
        .main-number.counting { transform: scale(0.95) rotate(-5deg); opacity: 0.8; }
        .main-number.final-zoom { transform: scale(1.1) rotate(0deg); opacity: 1; text-shadow: 3px 3px 8px rgba(0,0,0,0.5); }
        .main-text { font-size: 1.1rem; line-height: 1.6; margin-bottom: 30px; font-weight: 400; max-width: 550px; margin-left: auto; margin-right: auto; color: #e5e7eb; }
        .main-text b { color: #fde047; font-weight: 700; }
        
        .input-section { background: rgba(0, 0, 0, 0.3); border-radius: 15px; padding: 30px; margin-bottom: 30px; border: 1px solid rgba(255, 255, 255, 0.1); }
        .input-label { font-size: 1.1rem; margin-bottom: 15px; font-weight: 600; color: #fff; }
        .input-field { width: 100%; padding: 15px 20px; font-size: 1rem; border: 1px solid rgba(255,255,255,0.2); border-radius: 10px; background: rgba(0, 0, 0, 0.5); color: #fff; margin-bottom: 20px; outline: none; transition: all 0.3s ease; }
        .input-field:focus { background: rgba(0,0,0,0.7); transform: translateY(-2px); box-shadow: 0 5px 20px rgba(22, 163, 74, 0.4); border-color: #16a34a; }
        
        .submit-btn { background: linear-gradient(135deg, #16a34a 0%, #15803d 100%); color: #fff; border: none; padding: 15px 40px; font-size: 1.1rem; border-radius: 50px; cursor: pointer; transition: all 0.3s ease; font-weight: 700; font-family: 'Poppins', sans-serif; box-shadow: 0 4px 20px rgba(22, 163, 74, 0.4), inset 0 -2px 5px rgba(0,0,0,0.3); text-transform: uppercase; letter-spacing: 1px; }
        .submit-btn:hover { transform: translateY(-4px) scale(1.05); box-shadow: 0 8px 30px rgba(22, 163, 74, 0.6), inset 0 -2px 5px rgba(0,0,0,0.3); background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); }
        
        .result-display { display: none; text-align: center; animation: fadeInUp 0.6s ease; }
        .result-display.show { display: block; }
        .profile-avatar { width: 80px; height: 80px; border-radius: 50%; margin: 0 auto 15px; background: #27272a; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; color: #fde047; box-shadow: 0 4px 15px rgba(0,0,0,0.5); object-fit: cover; overflow: hidden; border: 3px solid #fde047; }
        .profile-username { font-size: 1.2rem; font-weight: 600; margin-bottom: 10px; color: #e5e7eb; font-family: 'Poppins', sans-serif; }
        .user-lucky-number { font-family: 'Luckiest Guy', cursive; font-size: 3.5rem; font-weight: 700; color: #fde047; margin: 10px 0; text-shadow: 0 0 15px rgba(253, 224, 71, 0.7); }
        .user-lucky-text { font-size: 1rem; line-height: 1.5; color: #d1d5db; font-style: italic; margin-bottom: 25px; opacity: 0.9; }
        
        .final-card-display { text-align: center; animation: fadeInUp 0.6s ease; }
        #displayedCardImage { max-width: 100%; width: 350px; height: auto; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.8); margin-bottom: 25px; transition: transform 0.3s ease; }
        #displayedCardImage:hover { transform: scale(1.05) rotate(2deg); }

        .action-buttons { display: flex; justify-content: center; gap: 15px; margin-top: 20px; flex-wrap: wrap; }
        .action-buttons > div { display: flex; justify-content: center; gap: 15px; width: 100%; flex-wrap: wrap; }

        .action-button { background: linear-gradient(135deg, #fde047 0%, #f59e0b 100%); color: #422006; border: none; padding: 12px 30px; font-size: 1rem; border-radius: 30px; cursor: pointer; transition: all 0.3s ease; font-weight: 700; font-family: 'Poppins', sans-serif; text-decoration: none; display: inline-block; box-shadow: 0 4px 15px rgba(0,0,0,0.4); }
        .action-button:hover { transform: translateY(-3px) scale(1.03); box-shadow: 0 6px 20px rgba(0,0,0,0.6); background: linear-gradient(135deg, #fef08a 0%, #facc15 100%); }
        .action-button.secondary { background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%); color: #fff; }
        .action-button.secondary:hover { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); }
        .action-button.final { background: linear-gradient(135deg, #4ade80 0%, #16a34a 100%); color: #fff; }
        .action-button.final:hover { background: linear-gradient(135deg, #86efac 0%, #22c55e 100%); }
        
        .loading-animation { display: none; text-align: center; padding: 30px; }
        .loading-animation.show { display: block; }
        .loading-spinner { width: 50px; height: 50px; border: 4px solid rgba(255, 255, 255, 0.1); border-top-color: #fde047; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px; }
        .loading-text { font-size: 1rem; color: #e5e7eb; font-weight: 400; min-height: 1.1rem; margin-bottom: 15px;}
        .loading-countdown { font-family: 'Luckiest Guy', cursive; font-size: 3rem; font-weight: 700; color: #fde047; }

        @keyframes spin { 100% { transform: rotate(360deg); } }
        .token-section { text-align: center; margin-top: 40px; max-width: 600px; width: 100%; }
        .token-title { font-size: 0.9rem; font-weight: 600; margin-bottom: 10px; color: #a1a1aa; text-transform: uppercase; letter-spacing: 1px; }
        .contract-address { font-family: 'monospace'; font-size: 0.9rem; color: #fde047; cursor: pointer; transition: all 0.3s ease; display: inline-block; padding: 10px 18px; border-radius: 8px; word-break: break-all; background: rgba(253, 224, 71, 0.1); border: 1px solid rgba(253, 224, 71, 0.2); }
        .contract-address:hover { background: rgba(253, 224, 71, 0.2); transform: translateY(-2px); color: #fef08a; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }

        /* --- Downloadable Card Styles --- */
        #downloadableCard {
            position: absolute;
            left: -9999px;
            width: 420px;
            height: 650px;
            font-family: 'Poppins', sans-serif;
            color: #fff;
            background-image: url('https://i.imgur.com/Q36A7aT.jpg'); /* Green felt with gold sparkle background */
            background-size: cover;
            background-position: center;
            border-radius: 25px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 30px;
            border: 5px solid #b8860b; /* Dark Goldenrod Border */
        }

        #cardContent {
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border: 1px solid rgba(253, 224, 71, 0.2);
            border-radius: 20px;
            padding: 25px;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            text-align: center;
        }

        #cardPfp {
            width: 110px;
            height: 110px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 15px;
            border: 4px solid #fde047;
            box-shadow: 0 0 20px rgba(253, 224, 71, 0.6);
        }
        
        #cardUsername { font-size: 1.8rem; font-weight: 700; margin-bottom: 5px; text-shadow: 1px 1px 3px rgba(0,0,0,0.8); }
        
        #cardLuckyNumber {
            font-family: 'Luckiest Guy', cursive;
            font-size: 6rem;
            line-height: 1;
            color: #fde047;
            text-shadow: 0 0 25px rgba(253, 224, 71, 0.8), 0 0 10px rgba(255,255,255,0.7), 3px 3px 5px rgba(0,0,0,0.6);
            margin: 10px 0;
        }
        
        #cardLuckyText { font-size: 1.1rem; line-height: 1.5; margin-top: 15px; font-weight: 400; max-width: 90%; text-shadow: 1px 1px 3px rgba(0,0,0,0.9); margin-left: auto; margin-right: auto; font-style: italic; }

        #cardCustomText {
            font-size: 1.1rem;
            font-style: normal;
            line-height: 1.5;
            margin-top: 12px;
            font-weight: 600;
            max-width: 90%;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
            margin-left: auto;
            margin-right: auto;
            color: #4ade80; /* Bright Green */
        }

        #cardContractAddress { font-family: 'monospace'; font-size: 0.8rem; opacity: 0.8; margin-top: 15px; margin-bottom: 8px; text-shadow: 1px 1px 2px rgba(0,0,0,0.9); word-break: break-all; padding: 0 10px; }

        #cardFooter { font-size: 0.9rem; opacity: 0.9; letter-spacing: 1px; font-weight: 600; }

        /* --- Meme Section --- */
        .meme-section {
            padding: 80px 20px;
            background: #0a0a0a;
        }

        .meme-container {
            max-width: 1000px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            gap: 40px;
        }

        .meme-text {
            flex: 1;
        }

        .meme-text h2 {
            font-family: 'Luckiest Guy', cursive;
            font-size: 2.8rem;
            color: #fde047;
            margin-bottom: 20px;
            line-height: 1.2;
        }

        .meme-text p {
            font-size: 1rem;
            line-height: 1.7;
            color: #d4d4d8;
            margin-bottom: 15px;
        }

        .meme-images {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .meme-images img {
            width: 100%;
            border-radius: 15px;
            border: 3px solid rgba(253, 224, 71, 0.3);
            box-shadow: 0 5px 25px rgba(0,0,0,0.5);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .meme-images img:hover {
            transform: scale(1.05) rotate(1deg);
            box-shadow: 0 8px 35px rgba(253, 224, 71, 0.2);
        }

        /* --- Responsive Styles --- */
        @media (max-width: 768px) {
            .container { padding: 25px; }
            .number-container { height: 6rem; }
            .main-number { font-size: 6.5rem; }
            .main-text { font-size: 1rem; padding: 0 10px; }
            .input-section { padding: 20px; }
            .user-lucky-number { font-size: 2.8rem; }
            .profile-avatar { width: 70px; height: 70px; }
            .action-button { padding: 10px 20px; font-size: 0.9rem; margin: 5px; }
            #displayedCardImage { width: 300px; }
            .token-section { margin-top: 30px; }
            .contract-address { font-size: 0.8rem; padding: 6px 12px; }
            
            .meme-container {
                flex-direction: column;
            }

            .meme-text h2 {
                font-size: 2.2rem;
                text-align: center;
            }
            .meme-text p {
                text-align: center;
            }

            .meme-images {
                width: 100%;
                max-width: 400px; /* Limit image width on mobile for better appearance */
            }
        }
    </style>
</head>
<body>

    <section class="hero-section">
        <div class="background-glow"></div>
        <div class="floating-numbers" id="floatingNumbersContainer"></div>

        <div class="container">
            <div class="header-icon">🍀</div>
            <div class="number-container">
                <div class="main-number active" id="mainNumber">777</div>
            </div>
            <div class="main-text">
                <b>Feeling lucky today?</b> Your fortune awaits! Every soul has a lucky number waiting to be discovered. Spin the wheel of fate, find your number, and unlock your cosmic good fortune.
            </div>
            
            <div class="input-section" id="inputSection">
                <div class="input-form" id="inputForm">
                    <div class="input-label">Enter Your Twitter Handle to Reveal Your Luck!</div>
                    <input type="text" class="input-field" placeholder="@username or twitter.com/link" id="twitterInput">
                    <button class="submit-btn" onclick="generateLuckyNumber()">Generate My Lucky Number</button>
                </div>
                
                <div class="loading-animation" id="loadingAnimation">
                    <div class="loading-spinner"></div>
                    <div class="loading-text" id="loadingStatusText"></div>
                    <div class="loading-countdown" id="loadingCountdown"></div>
                </div>
                
                <div class="result-display" id="resultDisplay">
                    <img class="profile-avatar" id="profileAvatar" alt="User Profile Picture" crossorigin="anonymous">
                    <div class="profile-username" id="profileUsername">@username</div>
                    <div class="user-lucky-number" id="userLuckyNumber">777</div>
                    <div class="user-lucky-text" id="userLuckyText">Your fortune will appear here...</div>
                </div>

                <div class="final-card-display" id="finalCardDisplay" style="display: none;">
                    <img id="displayedCardImage" alt="Your Generated Lucky Number Card">
                </div>

                <div class="action-buttons">
                    <div id="generateCardActions" style="display: none;">
                        <button onclick="showCustomizationOptions()" class="action-button">Generate My Fortune Card</button>
                    </div>
                    <div id="customizationActions" style="display: none;">
                        <button onclick="addCustomFortune()" class="action-button">✍️ Write My Own</button>
                        <button onclick="generateAndPreviewCard(null)" class="action-button secondary">🔮 Get a Random Fortune</button>
                    </div>
                    <div id="downloadActions" style="display: none;">
                         <button onclick="downloadFinalCard()" class="action-button final">Download Card</button>
                    </div>
                    <div id="postDownloadActions" style="display: none;">
                        <a href="#" target="_blank" class="action-button" id="finalClaimButton">Claim Your Fortune</a>
                    </div>
                </div>
            </div>
            
            <div class="token-section">
                <div class="token-title">Token Contract Address</div>
                <div class="contract-address" id="contractAddress" onclick="copyToClipboard()">
                   71m8KRQvw3JJg8nVYCY6rchEKJsPu7c9jTcW61fTpump
                </div>
            </div>
        </div>
    </section>

    <section class="meme-section">
        <div class="meme-container">
            <div class="meme-text">
                <h2>Ride the Wave of Luck!</h2>
                <p>This isn't just another coin; it's a movement powered by pure luck and positive vibes. We believe that fortune favors the bold, and by holding our token, you're aligning yourself with the cosmic energy of abundance.</p>
                <p>Every number tells a story, every meme brings a smile. Join our community of high-rollers and diamond hands as we laugh our way to the moon. This is where crypto fun meets real fortune!</p>
            </div>
            <div class="meme-images">
                <!-- Replace these with your actual meme image URLs -->
                <img src="meme1.jpg" alt="Crypto Meme 1">
            </div>
        </div>
    </section>

    <div id="downloadableCard">
        <div id="cardContent">
            <div>
                <img id="cardPfp" alt="User Profile Picture" crossorigin="anonymous">
                <div id="cardUsername"></div>
                <div id="cardLuckyNumber"></div>
                <div id="cardLuckyText"></div>
                <div id="cardCustomText" style="display: none;"></div>
            </div>
            <div>
                <div id="cardContractAddress"></div>
                <div id="cardFooter">
                    yourwebsite.fun
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            createFloatingNumbers();
            animateDisplayNumber();
        });

        const luckyFortunes = [
            "A golden opportunity is coming your way. Seize it!", "Your luck is about to change in a big way.", "Fortune favors the bold, and today you are the boldest.", "Expect a shower of abundance and good vibes.", "The universe is conspiring to make you smile.", "Jackpot! You've hit the cosmic lottery of good luck.", "Good things come to those who hustle. Your reward is near.", "Your positive energy is a magnet for miracles.", "Today, you're officially luckier than a leprechaun.", "Get ready for a stroke of genius and a dash of luck."
        ];

        const luckyNumbersList = [7, 77, 777, 8, 88, 888, 13, 21, 111, 333];
        let isAnimating = false;
        
        let statusInterval, countdownInterval;
        let generatedImageDataUrl = '';

        function createFloatingNumbers() {
            const container = document.getElementById('floatingNumbersContainer');
            const numbersCount = 20; // Number of floating numbers
            for (let i = 0; i < numbersCount; i++) {
                const numberSpan = document.createElement('span');
                numberSpan.textContent = Math.floor(Math.random() * 999);
                
                // Randomize properties
                numberSpan.style.left = `${Math.random() * 100}vw`;
                numberSpan.style.fontSize = `${Math.random() * 2 + 1}rem`; // Size between 1rem and 3rem
                numberSpan.style.animationDuration = `${Math.random() * 10 + 8}s`; // Duration between 8s and 18s
                numberSpan.style.animationDelay = `${Math.random() * 10}s`;

                container.appendChild(numberSpan);
            }
        }

        function animateDisplayNumber() {
            if (isAnimating) return;
            isAnimating = true;

            const mainNumberElement = document.getElementById('mainNumber');
            const targetIndex = Math.floor(Math.random() * luckyNumbersList.length);
            const targetNumber = luckyNumbersList[targetIndex];
            
            let currentNumber = parseInt(mainNumberElement.textContent);
            
            const duration = 1500;
            const frameRate = 30;
            const totalFrames = duration / (1000 / frameRate);
            let frame = 0;

            function updateNumber() {
                frame++;
                const progress = frame / totalFrames;
                const easedProgress = 1 - Math.pow(1 - progress, 3);

                const animatedNumber = Math.round(currentNumber + (targetNumber - currentNumber) * easedProgress);
                mainNumberElement.textContent = animatedNumber;
                mainNumberElement.classList.add('counting');

                if (frame < totalFrames) {
                    setTimeout(updateNumber, 1000 / frameRate);
                } else {
                    mainNumberElement.textContent = targetNumber;
                    mainNumberElement.classList.remove('counting');
                    mainNumberElement.classList.add('final-zoom');
                    setTimeout(() => mainNumberElement.classList.remove('final-zoom'), 200);
                    isAnimating = false;
                    setTimeout(animateDisplayNumber, 3000);
                }
            }
            updateNumber();
        }

        async function fetchTwitterData(username) {
            const response = await fetch(`/api/get_pfp?username=${encodeURIComponent(username)}`);
            const data = await response.json();
            if (!response.ok || !data.pfp_url) {
                throw new Error(data.error || 'Could not retrieve Twitter data.');
            }
            return data;
        }

        async function generateLuckyNumber() {
            const input = document.getElementById('twitterInput').value.trim();
            if (!input) {
                alert('Please enter a Twitter username or link');
                return;
            }
            let username = '';
            try {
                 if (input.includes('twitter.com/') || input.includes('x.com/')) {
                    const url = new URL(input);
                    username = url.pathname.split('/')[1];
                } else {
                    username = input.startsWith('@') ? input.substring(1) : input;
                }
                if (!username || !/^[a-zA-Z0-9_]{1,15}$/.test(username)) throw new Error("Invalid username");
            } catch (error) {
                alert('Could not parse a valid username. Please enter a valid Twitter username or profile link.');
                return;
            }

            document.getElementById('inputForm').style.display = 'none';
            document.getElementById('resultDisplay').classList.remove('show');
            document.getElementById('loadingAnimation').classList.add('show');
            
            const loadingStates = ["Consulting the cosmos...", "Shuffling the cards of fate...", "Rolling the lucky dice...", "Revealing your good fortune..."];
            let statusIndex = 0;
            const statusElement = document.getElementById('loadingStatusText');
            statusElement.textContent = loadingStates[statusIndex];
            statusInterval = setInterval(() => {
                statusIndex = (statusIndex + 1) % loadingStates.length;
                statusElement.textContent = loadingStates[statusIndex];
            }, 1500);

            let countdown = 5;
            const countdownElement = document.getElementById('loadingCountdown');
            countdownElement.textContent = countdown;
            const countdownPromise = new Promise(resolve => {
                countdownInterval = setInterval(() => {
                    countdown--;
                    countdownElement.textContent = countdown > 0 ? countdown : '🍀';
                    if (countdown <= 0) {
                        clearInterval(countdownInterval);
                        resolve();
                    }
                }, 1000);
            });

            try {
                const [twitterData] = await Promise.all([fetchTwitterData(username), countdownPromise]);
                clearInterval(statusInterval);
                
                const luckyNumber = Math.floor(Math.random() * 999) + 1;
                const randomFortune = luckyFortunes[Math.floor(Math.random() * luckyFortunes.length)];

                document.getElementById('profileAvatar').src = twitterData.pfp_url;
                document.getElementById('cardPfp').src = twitterData.pfp_url;
                
                await new Promise((resolve, reject) => {
                    document.getElementById('cardPfp').onload = resolve;
                    document.getElementById('cardPfp').onerror = reject;
                });
                
                const contractAddress = document.getElementById('contractAddress').textContent.trim();
                
                document.getElementById('profileUsername').textContent = '@' + username;
                document.getElementById('userLuckyNumber').textContent = luckyNumber;
                document.getElementById('userLuckyText').textContent = `"${randomFortune}"`;

                document.getElementById('cardUsername').textContent = '@' + username;
                document.getElementById('cardLuckyNumber').textContent = luckyNumber;
                document.getElementById('cardLuckyText').textContent = `"${randomFortune}"`;
                document.getElementById('cardContractAddress').textContent = contractAddress;
                document.getElementById('cardFooter').textContent = "attractwealth.fun";
                
                document.getElementById('finalClaimButton').href = 'https://x.com/i/communities/1935749463731032163';
                
                document.getElementById('loadingAnimation').classList.remove('show');
                document.getElementById('resultDisplay').classList.add('show');
                document.getElementById('generateCardActions').style.display = 'flex';
                document.getElementById('customizationActions').style.display = 'none';
                document.getElementById('downloadActions').style.display = 'none';
                document.getElementById('postDownloadActions').style.display = 'none';
                
            } catch (error) {
                console.error('Error during generation:', error);
                clearInterval(statusInterval);
                clearInterval(countdownInterval);
                alert(`The name "${username}" is not aligned with the cosmos or is not a valid spirit name. Try another!`);
                resetGenerator();
            }
        }
        
        function showCustomizationOptions() {
            document.getElementById('generateCardActions').style.display = 'none';
            document.getElementById('customizationActions').style.display = 'flex';
        }

        function addCustomFortune() {
            const customText = prompt("Enter your own fortune or lucky quote (max 30 characters):", "");
            if (customText === null) { return; }
            if (customText.length > 30) {
                alert("Your message is too long! Please keep it to 30 characters or less.");
                return;
            }
            generateAndPreviewCard(customText, true);
        }

        function generateAndPreviewCard(text = null, isCustom = false) {
            const cardElement = document.getElementById('downloadableCard');
            const cardLuckyTextElement = document.getElementById('cardLuckyText');
            const cardCustomTextElement = document.getElementById('cardCustomText');

            if (isCustom) {
                cardCustomTextElement.textContent = `"${text.trim()}"`;
                cardCustomTextElement.style.display = 'block';
                cardLuckyTextElement.style.display = 'none';
            } else {
                cardCustomTextElement.style.display = 'none';
                cardLuckyTextElement.style.display = 'block';
            }
            
            document.getElementById('customizationActions').style.display = 'none';

            setTimeout(() => {
                html2canvas(cardElement, {
                    useCORS: true, backgroundColor: null, scale: 2
                }).then(canvas => {
                    generatedImageDataUrl = canvas.toDataURL('image/png');
                    document.getElementById('displayedCardImage').src = generatedImageDataUrl;
                    document.getElementById('resultDisplay').style.display = 'none';
                    document.getElementById('finalCardDisplay').style.display = 'block';
                    document.getElementById('downloadActions').style.display = 'flex';
                    document.getElementById('finalCardDisplay').scrollIntoView({ behavior: 'smooth', block: 'center' });
                }).catch(err => {
                    console.error('Oops, something went wrong!', err);
                    alert('Sorry, there was an error creating your card image.');
                    resetGenerator();
                });
            }, 100);
        }
        
        function downloadFinalCard() {
            const username = document.getElementById('cardUsername').textContent.replace('@', '');
            if (!generatedImageDataUrl) {
                alert('Card image data not found. Please try generating the card again.');
                return;
            }
            const link = document.createElement('a');
            link.download = `lucky-number-card-${username}.png`;
            link.href = generatedImageDataUrl;
            link.click();
            document.getElementById('downloadActions').style.display = 'none';
            document.getElementById('postDownloadActions').style.display = 'flex';
        }

        function copyToClipboard() {
            const contractAddress = document.getElementById('contractAddress').textContent.trim();
            const addressElement = document.getElementById('contractAddress');
            navigator.clipboard.writeText(contractAddress).then(() => {
                const originalText = addressElement.textContent;
                addressElement.textContent = 'Copied! ✅';
                addressElement.style.background = 'rgba(22, 163, 74, 0.4)';
                addressElement.style.color = '#fff';
                setTimeout(() => {
                    addressElement.textContent = originalText;
                    addressElement.style.background = 'rgba(253, 224, 71, 0.1)';
                    addressElement.style.color = '#fde047';
                }, 2000);
            }).catch(() => {
                alert('Could not copy to clipboard.');
            });
        }

        function resetGenerator() {
            document.getElementById('resultDisplay').classList.remove('show');
            document.getElementById('finalCardDisplay').style.display = 'none';
            document.getElementById('loadingAnimation').classList.remove('show');
            document.getElementById('generateCardActions').style.display = 'none';
            document.getElementById('customizationActions').style.display = 'none';
            document.getElementById('downloadActions').style.display = 'none';
            document.getElementById('postDownloadActions').style.display = 'none';
            document.getElementById('inputForm').style.display = 'block';
            document.getElementById('twitterInput').value = '';
        }
        
        document.getElementById('twitterInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                generateLuckyNumber();
            }
        });
    </script>
</body>
</html>
